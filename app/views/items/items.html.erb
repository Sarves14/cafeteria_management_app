<div class="Item-page">
  <div class="Menu">
    <%Category.all.each do |category|%>
      <div class="ItemCategory">
        <h1 class="ItemCategory-name"><%=category.category_name%></h1>
          <%category.items.each do |category_item|%>
            <div class="ItemCategory-item">
              <p class="ItemCategory-item-element">
                <span style="margin-right:30px"><%=category_item.item_name%></span>
                Rs. <%=category_item.price%>
              </p>
              <div class="ItemCategory-item">
                <%if Cart.where("user_id = ? and item_id = ?",@current_user.id, category_item.id).count > 0 &&%>
                  <%=form_with(url: "#{carts_path}/#{category_item.id}", method: "put" , class: "btn-form") do |form|%>
                    <%= form.hidden_field :item_quantity, value:(Cart.where("user_id = ? and item_id = ?",@current_user.id, category_item.id).first.item_quantity + 1)  %>
                    <%= form.submit :"+", class: "ItemCategory-item-elementbtn-add" %>
                  <%end%>
                  <p class="ItemCategory-item-elementtxt">
                    <%=Cart.where("user_id = ? and item_id = ?",@current_user.id, category_item.id).first.item_quantity%>
                  </p>
                  <%=form_with(url: "#{carts_path}/#{category_item.id}", method: "put" ) do |form|%>
                    <%= form.hidden_field :item_quantity, value:(Cart.where("user_id = ? and item_id = ?",@current_user.id, category_item.id).first.item_quantity - 1)  %>
                    <%= form.submit :"-" , class: "ItemCategory-item-elementbtn-remove"%>
                  <%end%>
                <%else%>
                  <%=form_with(url: "#{carts_path}", method: "post" ) do |form|%>
                    <%= form.hidden_field :item_id, value:(category_item.id)  %>
                    <%= form.submit :Add , class: "ItemCategory-item-elementadd"%>
                  <%end%>
                <%end%>
              </div>
            </div>
          <%end%>
      </div>
      <hr>
    <%end%>
  </div>
  <div class="Details">
    <div class="Cart">
      <h1 class="Cart-heading">My Cart</h1>
      <p class="Cart-element">
          <span class="Cart-element-text" >Item</span>
          <span class="Cart-element-text">Quantity</span>
          <span class="Cart-element-text">Price</span>
      </p>
      <hr>
      <%total=0%>
      <%Cart.where("user_id = ?",@current_user.id).each do |cart_item, index|%>
        <p class="Cart-element">
          <%item=Item.find(cart_item.item_id)%>
          <span class="Cart-element-text" ><%=item.item_name%></span>
          <span class="Cart-element-text"><%=cart_item.item_quantity%></span>
          <span class="Cart-element-text"><%=item.price%></span>
          <%total=total+(item.price*cart_item.item_quantity)%>
        </p>
      <%end%>
      <hr>
      <%if Cart.where("user_id = ?",@current_user.id).count > 0%>
        <p class="Cart-element">
          <span class="Cart-element-text" >Total</span>
          <span class="Cart-element-text" ><%="Rs. #{total}"%></span>
        </p>
      <%end%>


      <p class="Cart-element">
        <%=form_with(url: "#{orders_path}", method: "post" ) do |form|%>
          <%= form.submit :"Check Out" , data: {confirm: "Are you sure to place order?"}, class: "Cart-checkout"%>
        <%end%>
      </p>
    </div>
    <hr>
    <div class="Order">
      <h1>Pending Orders</h1>
      <hr>
      <%if Order.where("user_id = ? ",@current_user.id).where(delivered_time: nil).count > 0%>
        <%orders = Order.where("user_id = ?",@current_user.id)%>
        <%orders.each do |order_item|%>
          <div class="Bill">
            <div class="Bill-header">
              <p>order id: <%=order_item.id%><p>
              <p>
                <%=order_item.ordered_time.localtime.strftime("%d/%m/%Y  %k:%M")%>
              </p>
            </div>
            <div class="Bill-element">
              <p class="Bill-element-text">s.no</p>
              <p class="Bill-element-text">item name</p>
              <p class="Bill-element-text">quantity</p>
              <p class="Bill-element-text">price</p>
            </div>
            <div class="Bill-element">
              <%items=Orderitem.where("order_id = ?",order_item.id)%>
              <%items.each_with_index do |item,i|%>
                <p class="Bill-element-text">
                  <%=(i+1)%>
                </p>
                <p class="Bill-element-text">
                  <%=Item.find(item.item_id).item_name%>
                </p>
                <p class="Bill-element-text">
                  <%=item.quantity%>
                </p>
                <p class="Bill-element-text">
                  <%=(item.quantity*Item.find(item.item_id).price)%>
                </p>
              <%end%>
            </div>
            <hr>
            <div class="Bill-element">
              <span class="Bill-element-text" >Total</span>
              <span class="Bill-element-text" ><%="Rs. #{order_item.price}"%></span>
            </div>
          </div>
          <hr>
        <%end%>
      <%end%>
    </div>
  </div>
</div>
